# AI Diet Plans (Smart Diet)

swasthyaMitra's **AI Diet Plan Service** generates daily, personalized meal plans using Google's **Gemini 1.5 Flash** (via Firebase Vertex AI). It combines user physiological data with Indian nutritional context to create culturally relevant plans.

## 1. How It Works

### Flow
1.  **User Context**: The app fetches the user's Profile (`age`, `weight`, `gender`), Goals (`targetCalories`, `dietActivity`), and **History** (recent meals to avoid repetition).
2.  **Prompt Engineering**: A structured prompt is built, instructing the AI to act as an "Indian Nutritionist".
    *   *Inputs*: "Vegetarian", "2000 kcal", "Avoid: Paneer (recently eaten)".
    *   *Constraints*: "No eggs", "Protein > 50g".
3.  **Generation**: The prompt is sent to `gemini-1.5-flash` (or `2.0-flash` depending on config).
4.  **Parsing**: The AI returns a **JSON** object, which the app parses into a `MealPlan` object.
5.  **Persistence**: The plan is saved to Firestore (`users/{userId}/ai_generated_plans`) for history tracking.

---

## 2. Sample AI Diet Plan

Here is an example of a diet plan generated by the system for a **Vegetarian User** (2000 kcal target):

```json
{
  "date": "2024-05-20",
  "totalCalories": 1950,
  "dailyTip": "Hydration is key! Drink at least 3 liters of water today. ðŸ’§",
  "breakfast": {
    "item": "Moong Dal Cheela with Mint Chutney",
    "calories": 450,
    "protein": "12g",
    "reason": "High-protein vegetarian breakfast, low oil, excellent for muscle repair.",
    "tip": "Add spinach to the batter for extra iron."
  },
  "lunch": {
    "item": "Bajra Roti with Baingan Bharta & Curd",
    "calories": 650,
    "protein": "18g",
    "reason": "Complex carbs from Bajra provide sustained energy; curd adds probiotics.",
    "tip": "Eat slowly to improve digestion."
  },
  "snack": {
    "item": "Roasted Makhana & Green Tea",
    "calories": 200,
    "protein": "5g",
    "reason": "Light, crunchy snack that satisfies cravings without spiking sugar.",
    "tip": "Avoid adding too much salt."
  },
  "dinner": {
    "item": "Paneer Tikka Salad (Grilled)",
    "calories": 500,
    "protein": "22g",
    "reason": "High protein, low carb dinner to support overnight recovery.",
    "tip": "Use lemon juice instead of heavy dressing."
  },
  "postWorkout": {
    "item": "Whey Protein Shake or Soya Milk",
    "calories": 150,
    "protein": "25g",
    "reason": "Rapid absorption protein for post-workout window.",
    "tip": "Consume within 30 mins of exercise."
  }
}
```

## 3. Data Sources & Logic

### Grounding Data (Optional)
The service has the capability to load real food samples from:
*   `assets/food_data.csv` (General Indian Foods)
*   `assets/vegan/` (Specific Vegan Datasets)

*Note: Currently disabled by default for performance (Latency vs Variety trade-off).*

### Dietary Logic
*   **Vegan**: Strict no-animal-product rules (Soy, Almond milk, Tofu).
*   **Vegetarian**: Dairy allowed, no eggs/meat.
*   **Menstrual Cycle**: If `isOnPeriod` is true, strict logic prioritizes Iron-rich foods (Spinach, Jaggery) and comfort meals.
*   **Festivals**: Checks current date against `FestivalCalendar` to suggest festival-appropriate treats (e.g., "Thandai" on Holi) in moderation.

## 4. Firestore Schema
Plans are stored in:
`users/{userId}/ai_generated_plans/{planId}`
field `status`: "Active" | "Completed"
